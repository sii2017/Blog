## socket编程 send函数
不论是客户还是服务器应用程序都用send函数来向TCP连接的另一端发送数据。客户程序一般用send函数向服务器发送请求，而服务器则通常用send函数来向客户程序发送应答。   
```c
int send( SOCKET s, const char FAR *buf, int len, int flags );     
```  
参数：   
该函数的第一个参数指定发送端套接字描述符；  
第二个参数指明一个存放应用程序要发送数据的缓冲区；   
第三个参数指明实际要发送的数据的字节数；   
第四个参数一般置0。     
### send执行流程
以下为同步socket的send函数的执行流程。当调用该函数时：  
（1）send先比较待发送数据的长度len和套接字s的发送缓冲的长度（并非参数buf的长度），如果len大于s的发送缓冲区的长度，该函数返回SOCKET\_ERROR；  
（2）如果len小于或者等于s的发送缓冲区的长度，那么send先检查协议是否正在发送s的发送缓冲中的数据，如果是就等待协议把数据发送完，如果协议还没有开始发送s的发送缓冲中的数据；或者s的发送缓冲中没有数据，那么send就比较s的发送缓冲区的剩余空间和len。   
（3）如果len大于缓冲区剩余空间大小，send就一直等待协议把s的发送缓冲中的数据发送完；   
（4）如果len小于缓冲区剩余空间大小，send就仅仅把buf中的数据copy到剩余空间里（**注意并不是send把s的发送缓冲中的数据传到连接的另一端的，而是TCP协议进行传输的，send仅仅是把buf中的数据copy到s的发送缓冲区的剩余空间里**）。   
（5）如果send函数copy数据成功，就返回实际copy的字节数，如果send在copy数据时出现错误，那么send就返回SOCKET\_ERROR；如果send在等待协议传送数据时网络断开的话，那么send函数也返回SOCKET\_ERROR。   
（6）要注意send函数把buf中的数据成功copy到s的发送缓冲的剩余空间里后它就返回了，**但是此时这些数据并不一定马上被传到连接的另一端。**如果协议在后续的传送过程中出现网络错误的话，那么下一个Socket函数就会返回SOCKET\_ERROR。   
每一个除send外的Socket函数在执行的最开始总要先等待套接字的发送缓冲中的数据被协议传送完毕才能继续，如果在等待时出现网络错误，那么该Socket函数就返回SOCKET\_ERROR。     