## Socket编程 套接字
Socket，它是使用标准Unix 文件描述符 (file descriptor) 和其它程序通讯的方式。   
Unix 程序在执行任何形式的I/O的时候，程序都是在读或者写一个文件描述符。一个文件描述符只是一个和打开的文件相关联的整数。但是，这个文件可能是一个网络连接，FIFO，管道，终端，磁盘上的文件或者什么其它的东西。Unix中所有的东西就是文件！   
所以，你想和Internet上别的程序通讯的时候，你将要使用到文件描述符。   
那么我从哪里得到网络通讯的文件描述符呢？   
我们可以利用系统调用socket()，它返回套接字描述符 (socket descriptor)，然后你再通过它来进行send() 和 recv()调用。   
```c
//举个小例子   
SOCKET listenSocket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);    
```    
在我们的世界上，有很多种套接字。有DARPA Internet 地址 (Internet 套接字)，本地节点的路径名 (Unix套接字)，CCITT X.25地址 (你可以将X.25 套接字完全忽略)。也许在你的Unix 机器上还有其它的。   
这里讲的Socket套接字仅仅是internet套接字。   
### Internet套接字的两种类型   
Internet套接字的类型不止两种，但是在这里只讲两种比较常用的。   
一种是"Stream Sockets"（流格式）；   
另外一种是"Datagram Sockets"（数据包格式）。   
我们以后在代码中也会用到相对应的 "SOCK_STREAM" 和 "SOCK_DGRAM"。   
### 流式套接字
流式的套接字可以提供可靠的、面向连接的通讯流。   
如果你通过流式套接字发送了顺序的数据：“1”“2”，那么数据到达远程时候的顺序也是“1”“2”。   
流式套接字可以做什么呢？比如Telnet应用程序，最常用的BBS服务,以及系统的远程登陆都是通过Telnet协议连接的。Telnet就是一个流式连接。你是否希望你在Telnet应用程序上输入的字符(或汉字)在到达远程应用程序的时候是以你输入的顺序到达的？答案应该是肯定的吧。还有WWW浏览器,它使用的HTTP协议也是通过流式套接字来获取网页的。   
流式套接字是怎样保证这种应用层次上的数据传输质量呢？它使用了TCP(The Transmission Control Protocol)协议(可以参考RFC-793来得到TCP的细节)。TCP保证了你的数据传输是正确的,并且是顺序的。TCP是经常出现的TCP/IP中的前半部分。IP代表Internet Protocol(因特网协议,参考RFC-791)IP只处理网络路由。   
### 数据报套接字 
数据报套接字定义了一种无连接的服务，数据通过相互独立的报文进行传输，是无序的，并且不保证可靠，无差错。   
为什么它叫做“无连接”？应该怎样处理它们呢？为什么它们是不可靠的？这里有一些事实:    
1 如果你发送了一个数据报，它可能不会到达。   
2 它可能会以不同的顺序到达。   
3 如果它到达了，它包含的数据中可能存在错误。   
数据报套接字也使用IP,但是它不使用TCP,它使用使用者数据报协议UDP(User Datagram Protocol可以参考RFC 768)   
为什么说它们是“无连接”的呢？因为它(UDP)不像流式套接字那样维护一个打开的连接，你只需要把数据打成一个包，把远程的IP贴上去，然后把这个包发送出去。这个过程是不需要建立连接的。UDP的应用例子有:tftp，bootp等。   
那么，数据包既然会丢失，怎样能保证程序能够正常工作呢？事实上，每个使用UDP的程序都要有自己的对数据进行确认的协议。比如，TFTP协议定义了对于每一个发送出去的数据包，远程在接受到之后都要回送一个数据包告诉本地程序：“我已经拿到了！(一个“ACK”包)。如果数据包发的送者在5秒内没有的得到回应，它就会重新发送这个数据包直到数据包接受者回送了“ACK”信号。这些知识对编写一个使用UDP协议的程序员来说是非常必要的。    
无连接服务器一般都是面向事务处理的，一个请求一个应答就完成了客户程序与服务程序之间的相互作用。面向连接服务器处理的请求往往比较复杂，不是一来一去的请求应答所能解决的，而且往往是并发服务器。   
### 套接字的工作过程
套接字工作过程如下：   
服务器首先启动，通过调用socket()建立一个套接字，然后调用bind()将该套接字和本地网络地址联系在一起，再调用listen()使套接字做好侦听的准备，并规定它的请求队列的长度，之后就调用accept()来接收连接。    
客户在建立套接字后就可调用connect()和服务器建立连接。连接一旦建立,客户机和服务器之间就可以通过调用read()和write()来发送和接收数据。最后,待数据传送结束后,双方调用close()关闭套接字。    
### 监听套接字和通讯套接字
初学时有一段时间被这两种套接字搞的乱七八糟，特别是在学习select函数的时候。   
通讯套接字和监听套接字都是套接字，在socket通讯的时候会用到。   
客户端一般只创建和使用通讯套接字，与服务器端进行连接，并且通讯数据内容。   
而服务器端一般先创建一个监听套接字，并且这个监听套接字会绑定自己的端口。   
监听套接字只负责接收连接，并不负责接收数据。因此当有连接从该监听套接字进来后。服务器端通过accept函数的返回值获取一个新的套接字，该套接字就是通讯套接字了，之后便通过通讯套接字进行数据接收了。而原来的监听套接字不受影响，继续监听任务。    