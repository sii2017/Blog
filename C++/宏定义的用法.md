## 宏定义
### \#define的概念
\#define命令是C语言中的一个宏定义命令，它用来将一个标识符定义为一个字符串，该标识符被称为宏名，被定义的字符串称为替换文本。   
> 该命令有两种格式：一种是简单的宏定义，另一种是带参数的宏定义。   
   
### 简单的宏定义：  
```c
#define 宏名 字符串   
#define PI 3.1415926   
```   
（1）宏名一般用大写。   
（2）使用宏可提高程序的通用性和易读性，减少不一致性，减少输入错误和便于修改。例如：数组大小常用宏定义。   
（3）预处理是在编译之前的处理，而编译工作的任务之一就是语法检查，预处理不做语法检查。  
（4）宏定义末尾不加分号。    
（5）宏定义写在函数的花括号外边，作用域为其后的程序，通常在文件的最开头。    
（6）可以用#undef命令终止宏定义的作用域。    
（7）宏定义可以嵌套。    
（8）字符串" "中永远不包含宏。   
（9）宏定义不分配内存，变量定义分配内存。   
### 带参数的宏定义
除了一般的字符串替换，还要做参数代换。   
```c
#define 宏名(参数) 宏体
#define S(a,b) a*b  
```   
（1）实参如果是表达式容易出问题。   
```c
#define S(r) r*r    
area=S(a+b);    
```   
第一步换为area=r*r,第二步被换为area=a+b*a+b。    
正确的宏定义是\#define S(r) ((r)*(r))    
（2）宏名和参数的括号间不能有空格。    
（3）宏替换只作替换，不做计算，不做表达式求解。    
（4）函数调用在编译后程序运行时进行，并且分配内存。宏替换在编译前进行，不分配内存。    
（5）宏的哑实结合不存在类型，也没有类型转换。     
（6）函数只有一个返回值，利用宏则可以设法得到多个值。    
（7）宏展开使源程序变长，函数调用不会。    
（8）宏展开不占运行时间，只占编译时间，函数调用占运行时间（分配内存、保留现场、值传递、返回值）。    
### 宏定义的优点
**(1) 方便程序的修改**    
使用简单宏定义可用宏代替一个在程序中经常使用的常量，这样在将该常量改变时，不用对整个程序进行修改，只修改宏定义的字符串即可。  
而当常量比较长时，我们可以用较短的有意义的标识符来写程序，这样更方便一些。如果我们编制的一个程序中要多次使用它，那么需要确定一个数值，在本次运行中不改变，但也许后来发现程序所表现的精度有变化，需要改变它的值，这就需要修改程序中所有的相关数值，这会给我们带来一定的不便，但如果使用宏定义，使用一个标识符来代替，则在修改时只修改宏定义即可，还可以减少输入 3.1415926这样长的数值多次的情况，我们可以如此定义\#define pi 3.1415926，既减少了输入又便于修改。       
**(2) 提高程序的运行效率**    
使用带参数的宏定义可完成函数调用的功能，又能减少系统开销，提高运行效率。正如C语言中所讲，函数的使用可以使程序更加模块化，便于组织，而且可重复利用，但在发生函数调用时，需要保留调用函数的现场，以便子 函数执行结束后能返回继续执行，同样在子函数执行完后要恢复调用函数的现场，这都需要一定的时间，如果子函数执行的操作比较多，这种转换时间开销可以忽略，但如果子函数完成的功能比较少，甚至于只完成一点操作，如一个乘法语句的操作，则这部分转换开销就相对较大了，但使用带参数的宏定义就不会出现这个问题，因为它是在预处理阶段即进行了宏展开，在执行时不需要转换，即在当地执行。宏定义可完成简单的操作，但复杂的操作还是要由函数调用来完成，而且宏定义所占用的目标代码空间相对较大。所以在使用时要依据具体情况来决定是否使用宏定义。     
### define中的三个特殊符号：\#，\#\#，\#@
**(1)x##y表示x连接y**     
```c
#define Conn(x,y) x##y   
int n = Conn(123,456); /* 结果就是n=123456;*/    
char* str = Conn("asdf", "adf"); /*结果就是 str = "asdfadf";*/    
```    
**（2）\#@x是给x加上单引号，结果返回是一个const char**
```c   
#define ToChar(x) #@x   
char a = ToChar(1);//结果就是a='1';    
```   
做个越界试验char a = ToChar(123)，结果就错了。但是如果参数超过四个字符，编译器就报错了。   
**(3）#x是给x加双引号**   
```c   
#define ToString(x) #x    
char* str = ToString(123132);	//就成了str="123132";    
```   